---
title: 发布订阅模式
date: 2022/06/13 22:29:12
tags: [ES6,JavaScript]
categories: 技术
cover: static\img\photo-1591693117893-7cbfc0a7ac69.jpg
---
## 发布订阅模式

什么是发布消息订阅模式?

基于一个事件通道

希望接收通知的对象A通过自定义事件订阅主题

被激活事件的对象B通过发布主题事件的方式通知各个订阅该主题的A对象

```
 class Observer {
    constructor(){
      // 事件中心
      // 存储方式为： {a: [], b: []}
      // 每个任务下存放其订阅者事件
      this.message = {}
    }
    //订阅方法
    $on(type, fn){
      // 如果没有订阅消息就初始化一个数组
      if(!this.message[type]){
        this.message[type] = []
      }
      // 有订阅消息就push到订阅者事件数组里
      this.message[type].push(fn)
    }
    // 取消订阅
    $off(type, fn){
      // 判断你有没有订阅
      if(!this.message[type]) return 
      // 判断有没有在订阅者事件队列中没有就删除队列
      if(!fn){
        this.message[type] = undefined
      }
      // 如果存在订阅者事件就过滤掉它
      this.message[type] = this.message[type].filter(item => item !== fn)
    }
    // 发送消息
    $emit(type){
      if(!this.message[type]) return '没有找到该消息'
      this.message[type].forEach(item => item() )
    }
  }
  // 发布者
  const person1 = new Observer()
  // 订阅一下内容
   person1.$on('abc', handleClickA)
   person1.$on('quit',handleClickB)
   person1.$on('uuid',handleClickC)
   person1.$off('abc',handleClickA)
   person1.$emit('abc')
   person1.$emit('quit')
   person1.$emit('uuid')
   function handleClickA(){
     console.log(1111)
   }
   function handleClickB(){
     console.log(2222)
   }
   function handleClickC(){
     console.log(3333)
   }
```

