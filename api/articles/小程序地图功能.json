{"title":"小程序","uid":"cc519f18fc7027e7d44b9a0621d59e8e","slug":"小程序地图功能","date":"2022-08-07T12:48:01.000Z","updated":"2022-08-07T12:49:20.303Z","comments":true,"path":"api/articles/小程序地图功能.json","keywords":null,"cover":"static\\img\\ok.jpg","content":"<h3 id=\"小程序地图功能\"><a href=\"#小程序地图功能\" class=\"headerlink\" title=\"小程序地图功能\"></a>小程序地图功能</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 小程序内置了一个地图组件map用于展示地图\n &lt;map\n   style&#x3D;&quot;width: 100%; height: 100vh&quot; \n   :latitude&#x3D;&quot;points.latitude&quot; &#x2F;&#x2F; 纬度\n   :longitude&#x3D;&quot;points.longitude&quot;  &#x2F;&#x2F; 经度\n   :markers&#x3D;&quot;covers&quot; &#x2F;&#x2F; 地图中自定义图标点\n   id&#x3D;&quot;map1&quot;\n   ref&#x3D;&quot;map1&quot;\n   show-location\n   @markertap&#x3D;&#39;showMaker&#39;&gt; &#x2F;&#x2F; 图标点击事件\n &lt;&#x2F;map&gt;</code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; js\n&#x2F;&#x2F; 点击地图时获取用户权限,权限获取失败提醒用户是否授权位置\n async findWC() &#123;\n   let that &#x3D; this\n   try&#123;\n     await this.getWxlocation() &#x2F;&#x2F; 调用地图定位方法进行定位\n\t setTimeout(() &#x3D;&gt; &#123; &#x2F;&#x2F; 进入地图时获取附近建筑点由于使用了async,awitch\n\t   this.getMapData() &#x2F;&#x2F; 这边采用定时器创建一个宏任务使该方法能正常调用\n\t &#125;,1500)\n\t &#125;catch(err)&#123;\n\t  &#x2F;&#x2F; 用户没有授权时提醒用户\n\t   uni.showModal(&#123;\n\t     title: &#96;温馨提示&#96;,\n\t\t content: &#39;获取权限失败,需要获取您的地理位置才能更好的为您服务!,是否授权地理位置?&#39;,\n\t\t showCancel: true,\n\t\t cancelText: &#39;取消&#39;,\n\t\t confirmText: &#39;前往设置&#39;,\n\t\t success(&#123;confirm,cancel&#125;)&#123;\n\t\t   if(confirm)&#123;\n\t\t     that.toSetting() &#x2F;&#x2F; 用户点击前往设置需要授权时调用权限面板\n\t\t     return\n\t\t   &#125;\n\t\t   if(cancel)&#123;\n\t\t     uni.showToast(&#123;\n\t\t\t   title: &#96;取消授权&#96;,\n\t\t\t   icon: &#39;none&#39;\n\t\t\t&#125;)\n\t\t\t&#125;\n\t\t\t&#125;,\n\t\t\t fail()&#123;&#125;\n\t\t\t    &#125;)\n\t\t\t  &#125;\n\t\t\t&#125;\n\t\t\t点击时获得自己的位置并发送请求给后端查询附近的建筑点\n&#x2F;&#x2F; 调用用户手机授权面板获取位置权限\n  toSetting()&#123;\n    let that &#x3D; this\n\tuni.openSetting(&#123;\n\t  success(res)&#123;\n\t  &#x2F;&#x2F; 判断用户是否选中地图权限\n\t    if(res.authSetting[&#39;scope.userLocation&#39;])&#123;\n\t      uni.showToast(&#123;\n\t\t  title: &#39;授权成功&#39;,\n\t\t  icon: &#39;none&#39;\n\t\t&#125;)\n\t    &#125;\n\t\t&#125;  \n\t\t&#125;)\n\t &#125;\n&#x2F;&#x2F; 地图定位\ngetWxlocation()&#123;\n  let that &#x3D; this\n  uni.showLoading(&#123;\n    title: &#39;定位中...&#39;,\n\tmask: true\n  &#125;)\n  &#x2F;&#x2F; 采用promise对获取位置进行封装\n  return new Promise((resolve, reject) &#x3D;&gt; &#123;\n    const locationChange &#x3D; (res) &#x3D;&gt; &#123;\n\t  that.points.latitude &#x3D; res.latitude &#x2F;&#x2F; 获取返回来的经纬度\n      that.points.longitude &#x3D; res.longitude\n\t  uni.hideLoading() &#x2F;&#x2F; 隐藏加载动画\n\t  wx.offLocationChange(locationChange) &#x2F;&#x2F; 解除绑定\n\t  that.flag &#x3D; true \n\t  &#125;\n\t  &#x2F;&#x2F; 获取位置\n\t\twx.startLocationUpdate(&#123;\n\t\t  success(res)&#123;\n\t\t    wx.onLocationChange(locationChange)\n\t\t\tresolve()\n\t\t &#125;,\n\t\t  fail(err)&#123;\n\t\t    uni.showToast(&#123;\n\t\t\t  title: &#96;获取位置失败$&#123;err&#125;&#96;,\n\t\t\t  icon: &#39;none&#39;\n\t\t\t&#125;)\n\t\t\tuni.hideLoading()\n\t\t\treject()\n\t\t\t&#125;\n\t\t   &#125;)\n\t\t   &#125;)\n\t\t&#125;</code></pre>\n\n","text":"小程序地图功能&#x2F;&#x2F; 小程序内置了一个地图组件map用于展示地图 &lt;map style&#x3D;&quot;width: 100%; height: 100vh&quot; :latitude&#x3D;&quot;points.latitude&quo...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"技术","slug":"技术","count":21,"path":"api/categories/技术.json"}],"tags":[{"name":"小程序","slug":"小程序","count":3,"path":"api/tags/小程序.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%9C%B0%E5%9B%BE%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">小程序地图功能</span></a></li></ol>","author":{"name":"小提琴","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"我见青山多妩媚，料青山、见我应如是。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"小程序","uid":"cc519f18fc7027e7d44b9a0621d59e8e","slug":"uni上传功能","date":"2022-08-07T12:48:01.000Z","updated":"2022-08-07T12:56:56.667Z","comments":true,"path":"api/articles/uni上传功能.json","keywords":null,"cover":"static\\img\\ok.jpg","text":"uni上传功能&#x2F;&#x2F;上传图片 chooseImage() &#123; let that &#x3D; this; let imgArr &#x3D; that.imgArr; let imgTemp &#x3D; &#39;&#39; &#x2F;&#x2F;...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"技术","slug":"技术","count":21,"path":"api/categories/技术.json"}],"tags":[{"name":"小程序","slug":"小程序","count":3,"path":"api/tags/小程序.json"}],"author":{"name":"小提琴","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"我见青山多妩媚，料青山、见我应如是。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"ui库input文本框","uid":"af1ec4b22e6834df21b119ba73ac155f","slug":"自定义封装dialog对话框","date":"2022-06-27T03:48:12.000Z","updated":"2022-06-27T15:53:11.599Z","comments":true,"path":"api/articles/自定义封装dialog对话框.json","keywords":null,"cover":"static\\img\\photo-1571361656693-d7602246ce3c.jpg","text":"自定义封装input文本框前置知识 vue过渡动画 sync修饰符 具名插槽与v-slot指令 参数 参数名 参数描述 参数类型 默认值 title 对话框标题 string 提示 width 宽度 string 50% top 与顶部距离 string 200px visibl...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"ui库","slug":"ui库","count":5,"path":"api/categories/ui库.json"}],"tags":[{"name":"ui库","slug":"ui库","count":5,"path":"api/tags/ui库.json"}],"author":{"name":"小提琴","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"我见青山多妩媚，料青山、见我应如是。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}